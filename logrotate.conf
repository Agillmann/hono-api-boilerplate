# Logrotate configuration for API Boilerplate
# Usage: logrotate -f /path/to/logrotate.conf

/path/to/api-boilerplate/logs/*.log {
    # Rotate logs daily
    daily
    
    # Keep 30 days of logs (30 files)
    rotate 30
    
    # Maximum log file size before rotation (100MB)
    size 100M
    
    # Compress rotated logs (saves disk space)
    compress
    
    # Don't rotate if empty
    notifempty
    
    # Don't error if log file is missing
    missingok
    
    # Use date as suffix for rotated files
    dateext
    
    # Don't rotate the same file multiple times in one day
    dateformat -%Y%m%d-%H%M%S
    
    # Copy and truncate the original log file (keeps file handle open)
    copytruncate
    
    # Set permissions for rotated files
    create 644 www-data www-data
    
    # Specific rules for different log types
}

# Access logs - more frequent rotation due to high volume
/path/to/api-boilerplate/logs/access.log {
    hourly
    rotate 168  # 7 days * 24 hours
    size 50M
    compress
    delaycompress
    notifempty
    missingok
    dateext
    copytruncate
    create 644 www-data www-data
}

# Error logs - keep longer for debugging
/path/to/api-boilerplate/logs/error.log {
    daily
    rotate 90   # 90 days
    size 50M
    compress
    notifempty
    missingok
    dateext
    copytruncate
    create 644 www-data www-data
}

# Admin activity logs - keep for compliance/auditing
/path/to/api-boilerplate/logs/admin.log {
    weekly
    rotate 52   # 1 year
    size 100M
    compress
    notifempty
    missingok
    dateext
    copytruncate
    create 644 www-data www-data
    
    # Run a command after rotation (optional)
    postrotate
        # Reload application if needed
        # /bin/kill -USR1 `cat /var/run/api-boilerplate.pid 2>/dev/null` 2>/dev/null || true
    endscript
}

# Authentication logs - security sensitive, keep longer
/path/to/api-boilerplate/logs/auth.log {
    daily
    rotate 180  # 6 months
    size 25M
    compress
    notifempty
    missingok
    dateext
    copytruncate
    create 644 www-data www-data
}